<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://meta-bit.github.io/mconfig/21_how_it_works.html" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>2.1 How it Works - mConfig Documentation</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "2.1 How it Works";
        var mkdocs_page_input_path = "21_how_it_works.md";
        var mkdocs_page_url = "/mconfig/21_how_it_works.html";
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> mConfig Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Part 1 Introduction & Basics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="11_what_is_mconfig.html">1.1 What is mConfig?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="12_features_and_use_cases.html">1.2 Features and Use Cases</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="13_getting_started.html">1.3 Getting Started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="14_regular_use.html">1.4 Regular Use</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="15_test_mode.html">1.5 Test Mode</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Part 2 Core Concepts</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">2.1 How it Works</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#self-configuration">Self-Configuration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#concept-scopes">Concept: Scopes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#scope-meanings-short-version">Scope meanings (short version)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#default-scope-and-source-hierarchy">Default scope and source hierarchy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#filesystem-search-paths-fileconfigstorage">Filesystem search paths (FileConfigStorage)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-process">The Process</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#layered-stack">Layered Stack</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#validation">validation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#changes-monitoring">Changes &amp; Monitoring</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#behind-the-scenes">Behind the Scenes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#anchor">Anchor</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#security-and-secrets">Security and Secrets</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#secret-redaction">Secret Redaction</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#the-secretvalue-api">The SecretValue API</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#binary-data-blobs">Binary Data (BLOBs)</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#hierarchical-blobs">Hierarchical BLOBs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#flat-binary-files">Flat Binary Files</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#failure-handling">Failure Handling</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="22_priorities_and_hierarchies.html">2.2 Priorities and Hierarchies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="23_configuration_schemes.html">2.3 Configuration Schemes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="24_comment_handling.html">2.4 Comment Handling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="25_config_features.html">2.5 Config Features</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Part 3 Advanced Topics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="31_writing_configurations.html">3.1 Writing Configurations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="32_updates.html">3.2 Updates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="33_getting_information.html">3.3 Getting Information</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="34_definitions_and_valid_values.html">3.4 Definitions and Valid Values</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="35_handling_secrets.html">3.5 Handling Secrets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="36_windows_registry.html">3.6 Windows Registry Access</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="37_extensions_and_advanced_use.html">3.7 Extensions and Advanced Use</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="38_code_improvements.html">3.8 Code Improvements</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Part 4 Reference & Project</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="41_mconfig_tool.html">4.1 mConfig Tool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="42_logging.html">4.2 Logging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="43_faq.html">4.3 FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="44_design_consolidated.html">4.4 Design Consolidated</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="45_ai_guidance.html">4.5 AI Guidance</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="46_versions.html">4.6 Versions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="47_contributing.html">4.7 Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="48_legal.html">4.8 Legal</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Examples</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="examples/index.html">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/simple_configuration_loading.html">Simple Configuration Loading</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/advanced_configuration_handling.html">Advanced Configuration Handling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/integration_with_cicd.html">Integration with CI/CD</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/testing_configurations.html">Testing Configurations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/mconfig-modules.html">mConfig Modules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/java-modules.html">JPMS (Java Modules)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/configuration_views.html">Configuration Views</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/zookeeper.html">ZooKeeper</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/handling_crypto_keys_and_certificates.html">Handling Crypto Keys and Certificates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="examples/schemes.html">Schemes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="49_links.html">4.9 Links</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mConfig Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Part 2 Core Concepts</li>
      <li class="breadcrumb-item active">2.1 How it Works</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="21-how-it-works">2.1 How it Works<a class="headerlink" href="#21-how-it-works" title="Permanent link">&para;</a></h1>
<p>To get started, we need a lot of preparation and settings.
These are collected in a factory builder, <code>ConfigFactoryBuilder</code>,
which then builds a <code>ConfigFactory</code> with specific settings.</p>
<h3 id="self-configuration">Self-Configuration<a class="headerlink" href="#self-configuration" title="Permanent link">&para;</a></h3>
<p>Before the ConfigFactory is fully operational, it may perform "self-configuration".
If the <code>mConfigSourceJAR</code> module is active, the factory searches the classpath for:
<code>.config/metabit/mConfig/mconfig.properties</code></p>
<p>This feature is enabled by default. It can be disabled by setting the <code>ENABLE_SELF_CONFIGURATION</code> flag to <code>false</code> in the <code>ConfigFactoryBuilder</code>.</p>
<p>Settings found in this file (or files, as it uses <code>ClassLoader.getResources()</code>) 
are used to populate the internal <code>ConfigFactorySettings</code>.
This allows the library to configure its own features 
(like enabling environment variable processing via <code>ALLOW_MCONFIG_RUNTIME_SETTINGS</code>) 
using its standard resource discovery layout.</p>
<p>The ConfigFactory in turn produces individual Configuration objects.</p>
<p>That's the startup phase; once that is done, you use the Configuration objects.</p>
<hr />
<h2 id="concept-scopes">Concept: Scopes<a class="headerlink" href="#concept-scopes" title="Permanent link">&para;</a></h2>
<p>mConfig uses the concept of hierarchical scopes (from the pre-2000 metabit MAUS project).</p>
<p>The software may have its generic defaults, which can be overridden by settings
of the individual local installation. But if you allow user-based settings,
these take precedence over the local installation; and settings given for the
individual software instance run may override those, in turn. It's a hierarchy.</p>
<p><strong>Scope order (lowest to highest priority):</strong>
<code>PRODUCT</code> -&gt; <code>ORGANIZATION</code> -&gt; <code>CLOUD</code> -&gt; <code>CLUSTER</code> -&gt; <code>HOST</code> -&gt; <code>APPLICATION</code> -&gt; <code>USER</code> -&gt; <code>SESSION</code> -&gt; <code>RUNTIME</code> -&gt; <code>POLICY</code></p>
<h3 id="scope-meanings-short-version">Scope meanings (short version)<a class="headerlink" href="#scope-meanings-short-version" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Intended use</th>
<th>Typical sources</th>
</tr>
</thead>
<tbody>
<tr>
<td>PRODUCT</td>
<td>Defaults shipped with the software.</td>
<td>ConfigScheme defaults, JAR resources</td>
</tr>
<tr>
<td>ORGANIZATION</td>
<td>Company-level defaults and licensing.</td>
<td>Registry, network services</td>
</tr>
<tr>
<td>CLOUD</td>
<td>Cloud-based configurations, shared across multiple clusters.</td>
<td>Cloud services, network services</td>
</tr>
<tr>
<td>CLUSTER</td>
<td>Cluster-wide settings.</td>
<td>ZooKeeper, network services</td>
</tr>
<tr>
<td>HOST</td>
<td>System-wide settings for one host.</td>
<td>Filesystem, Registry, System properties</td>
</tr>
<tr>
<td>APPLICATION</td>
<td>Installation-specific settings (portable installs, side-by-side versions).</td>
<td>Filesystem near the binary</td>
</tr>
<tr>
<td>USER</td>
<td>Per-user overrides and preferences.</td>
<td>Filesystem, Registry</td>
</tr>
<tr>
<td>SESSION</td>
<td>Shell/session overrides.</td>
<td>Environment variables, command-line</td>
</tr>
<tr>
<td>RUNTIME</td>
<td>In-memory changes at runtime.</td>
<td>RAM layer</td>
</tr>
<tr>
<td>POLICY</td>
<td>Enforced overrides (highest priority).</td>
<td>GPO/Registry, policy files</td>
</tr>
</tbody>
</table>
<h3 id="default-scope-and-source-hierarchy">Default scope and source hierarchy<a class="headerlink" href="#default-scope-and-source-hierarchy" title="Permanent link">&para;</a></h3>
<p>Resolution priority between different storage types (within the same scope) is deterministic.</p>
<p><strong>Default Storage Priority (Highest to Lowest):</strong>
1. <code>RAM</code> (In-memory overrides)
2. <code>secrets</code> (Encrypted/sensitive data)
3. <code>files</code> (Local filesystem)
4. <code>registry</code> (Windows Registry)
5. <code>registryjni</code> (Windows Registry JNI)
6. <code>zookeeper</code> (ZooKeeper module)
7. <code>JAR</code> (Classpath resources/defaults)</p>
<p>Use <code>STORAGE_TYPE_PRIORITIES</code> to change this order within a scope.</p>
<h3 id="filesystem-search-paths-fileconfigstorage">Filesystem search paths (FileConfigStorage)<a class="headerlink" href="#filesystem-search-paths-fileconfigstorage" title="Permanent link">&para;</a></h3>
<p>The lists below show the default search paths <em>as added to the search list</em>.
Earlier entries are preferred for <strong>creation</strong>; later entries override earlier ones
within the same scope. <code>SUB_PATH</code> (if set) is appended to the application paths.
<code>ADDITIONAL_*_DIRECTORIES</code> are prepended to their scope lists.</p>
<blockquote>
<p><strong>Optional Company Segment</strong>: <code>&lt;company&gt;</code> omitted if <code>COMPANY_NAME</code> blank/null/whitespace (recommended but can be intentionally left blank for app-only paths). Examples below show both forms where applicable.</p>
</blockquote>
<p><strong>Linux (and most Unix-like systems)</strong></p>
<p>HOST scope:
- <code>$XDG_CONFIG_DIRS</code> (default <code>/etc/xdg</code>), each entry: <code>&lt;dir&gt;/&lt;app&gt;</code>
- <code>/etc/opt/[&lt;company&gt;/]&lt;app&gt;/&lt;subPath&gt;</code>
- <code>/etc/opt/&lt;app&gt;/&lt;subPath&gt;</code>
- <code>/usr/local/etc/&lt;app&gt;/&lt;subPath&gt;</code>
- <code>/etc/&lt;app&gt;/&lt;subPath&gt;</code></p>
<p>USER scope:
- <code>$XDG_CONFIG_HOME/[&lt;company&gt;/]&lt;app&gt;/&lt;subPath&gt;</code> (if set)
- <code>~/.config/[&lt;company&gt;/]&lt;app&gt;/&lt;subPath&gt;</code>
- <code>~/.&lt;app&gt;/&lt;subPath&gt;</code>
- 
SESSION scope:
- <code>$PWD/.config/&lt;app&gt;/&lt;subPath&gt;</code></p>
<p><strong>Windows</strong></p>
<p>SESSION scope:
- <code>%CD%\\.config\\&lt;app&gt;\\&lt;subPath&gt;</code>
- <code>%CD%</code> (legacy side-by-side .ini, .properties, etc.)</p>
<p>USER scope:
- <code>%XDG_CONFIG_HOME%\\&lt;app&gt;\\&lt;subPath&gt;</code> (if set)
- <code>%AppData%\\[&lt;company&gt;\\&lt;]&lt;app&gt;\\&lt;subPath&gt;</code>
- <code>%LocalAppData%\\[&lt;company&gt;\\&lt;]&lt;app&gt;\\&lt;subPath&gt;</code>
- <code>%UserProfile%\\.config\\&lt;app&gt;\\&lt;subPath&gt;</code></p>
<p>APPLICATION scope:
- <code>&lt;appDir&gt;\\.config</code>
- <code>&lt;appDir&gt;</code></p>
<p>HOST scope:
- <code>%ProgramData%\\[&lt;company&gt;\\&lt;]&lt;app&gt;</code>
- <code>%AllUsersProfile%\\[&lt;company&gt;\\&lt;]&lt;app&gt;</code></p>
<p><strong>macOS (experimental)</strong></p>
<p>USER scope:
- <code>$XDG_CONFIG_HOME/[&lt;company&gt;/]&lt;app&gt;/&lt;subPath&gt;</code> (if set)
- <code>~/Library/Application Support/[&lt;company&gt;/]&lt;app&gt;/&lt;subPath&gt;</code>
- <code>~/Library/Preferences/[&lt;company&gt;/]&lt;app&gt;/&lt;subPath&gt;</code>
- <code>~/.&lt;app&gt;/&lt;subPath&gt;</code></p>
<p>HOST scope:
- <code>/Library/Application Support/[&lt;company&gt;/]&lt;app&gt;/&lt;subPath&gt;</code>
- <code>/Library/Preferences/[&lt;company&gt;/]&lt;app&gt;/&lt;subPath&gt;</code></p>
<p>APPLICATION scope:
- <code>&lt;appDir&gt;/.config</code>
- <code>&lt;appDir&gt;</code></p>
<p>SESSION scope:
- <code>$PWD/.config/&lt;app&gt;/&lt;subPath&gt;</code></p>
<p><strong>Android (experimental)</strong></p>
<p>APPLICATION scope:
- <code>/data/data/&lt;app&gt;/files/.config/&lt;subPath&gt;</code>
- <code>/data/data/&lt;app&gt;/files/&lt;subPath&gt;</code></p>
<p>USER scope:
- <code>/data/data/&lt;app&gt;/files/&lt;subPath&gt;</code>
- <code>/storage/emulated/0/Android/data/&lt;app&gt;/files/.config/&lt;subPath&gt;</code> (if <code>EXTERNAL_STORAGE</code> set)
- <code>/storage/emulated/0/Android/data/&lt;app&gt;/files/&lt;subPath&gt;</code></p>
<p>SESSION scope:
- <code>/data/data/&lt;app&gt;/cache/.config/&lt;subPath&gt;</code>
- Plus Linux-style fallbacks.</p>
<p><strong>Fallback (unknown OS)</strong></p>
<p>USER scope:
- <code>~/.&lt;app&gt;/&lt;subPath&gt;</code></p>
<p>HOST scope:
- <code>$PWD/.config/&lt;app&gt;/&lt;subPath&gt;</code></p>
<h2 id="the-process">The Process<a class="headerlink" href="#the-process" title="Permanent link">&para;</a></h2>
<h3 id="layered-stack">Layered Stack<a class="headerlink" href="#layered-stack" title="Permanent link">&para;</a></h3>
<p>When you ask for a ConfigEntry (or just its value) by providing a key, 
the library starts searching.
The normal method is using a layered stack, sorted by the aforementioned scopes.</p>
<p>At top, if enabled, is the cache layer, at RUNTIME scope.
Below it follow the other scopes, down to the PRODUCT scope, 
where you can find the defaults layer.</p>
<p>For each layer, the respective configuration source is asked whether it has
an entry matching the key. The topmost layer which has a valid entry wins,
and you get the ConfigEntry it has found.</p>
<p>If you asked for just the value, not the full ConfigEntry, then the library
tries to return the data found in the Java class matching the type of
value you asked for (e.g. Boolean, Integer, byte array).</p>
<h3 id="validation">validation<a class="headerlink" href="#validation" title="Permanent link">&para;</a></h3>
<p>Note the mention of <strong>valid</strong> data.
You can, and should, provide a ConfigScheme which declares the expected
entries, and some information about them.</p>
<p>Mandatory for this is a key (~ name), and a <em>type</em>.
The types match or are translated to types in the different config sources.
The type is also used for initial conversion of the data.
So if the type is NUMBER, then "xyyyzy" is not a valid value.</p>
<p>The default behaviour is to skip such entries, but log a warning - we want to
provide usable data to continue your program code with, best-effort. </p>
<p>An optional field allows for more specific restrictions to be applied to fields,
listing which contents are acceptable values.</p>
<p>When a ConfigScheme is activated for a Configuration
- it sets the DefaultLayer contents, if defaults are not disabled
- it becomes available for the Configuration, to check entries against. 
- it also is available for documentation generation</p>
<p>The checks are performed
@TODO continue</p>
<h2 id="changes-monitoring">Changes &amp; Monitoring<a class="headerlink" href="#changes-monitoring" title="Permanent link">&para;</a></h2>
<p>There's two different aspects to changes.</p>
<p>First, getting notifications when the <em>value</em> of a config entry changes.
This is actively checking, even polling, for changes, to notify your code about
such events. It checks across different ConfigSources, formats, and the like.</p>
<p>mConfig provides a subscription mechanism via <code>subscribeToUpdates(Consumer&lt;ConfigLocation&gt;)</code>. 
This allows applications (and tools like the <code>mconfig monitor</code> command) to react
to configuration changes in real-time.</p>
<p>Second, the automated cache flush for some config sources. For most, reading is
not much effort; but certain ones - especially files and parsing their formats -
are not that cheap. So these are read, parsed, and then cached for some time.</p>
<p>But the cache should not stay indefinitely, it needs to detect changes and/or
refresh automatically. → <code>ConfigFeature.UPDATE_CHECK_FREQUENCY_MS</code></p>
<h2 id="behind-the-scenes">Behind the Scenes<a class="headerlink" href="#behind-the-scenes" title="Permanent link">&para;</a></h2>
<p>mConfig uses these concepts for separation of concerns:</p>
<ul>
<li>
<p>ConfigSource is something where configurations come from. it returns Configuration instances.</p>
</li>
<li>
<p>ConfigStorage is a concept representing an access medium, e.g. Filesystem, OS registry, network config services. It provides the technical access.</p>
</li>
<li>
<p>ConfigFormat is how the configuration is structured and formatted inside the access medium.
  Files, specifically, come in a number of different formats; this handles the actual parsing.</p>
</li>
<li>
<p>ConfigLocation: Represents the specific path/handle (the "Directory" part).</p>
</li>
</ul>
<p>This is how it is supposed to be (and as of 0.6.x, isn't yet!)</p>
<pre><code class="language-mermaid">erDiagram
    Configuration    }|--|| ConfigFactory : &quot;comes from&quot;
    ConfigFactory    ||--|| ConfigSearchList : has
    Configuration    ||--|| ConfigSearchList : uses
    ConfigSearchList ||--|{ ConfigSource : contains
    ConfigSource     ||--|| ConfigLocation : &quot;has a specific&quot;
    ConfigSource     ||--|| ConfigStorage : &quot;reads from&quot;
    ConfigSource     ||--|| ConfigFormat : &quot;uses a specific&quot;
    ConfigStorage    ||--|{ ConfigFormat : &quot;compatible with&quot;

    Configuration    ||--o| ConfigScheme : &quot;may use&quot;
    ConfigScheme     ||--o{ ConfigSchemeEntry : contains 
</code></pre>
<p><strong>Configuration</strong> : the API interface to access configurations; produces/keeps ConfigEntry instances,
and provides simple access to the values.
They use their respective ConfigFactory search list, which consists of hierarchical and scoped
ConfigSource entries, to get ConfigEntry instances.</p>
<p><em>An Configuration object is a way to access configurations in an uniform way.</em></p>
<p><strong>ConfigSource</strong> : this is ((supposed to be)) the combined ConfigStorage+ConfigFormat tuple,
instantiated, for active use. It can produce Configuration instances, which link back to it.</p>
<p><em>A ConfigSource is where you can get a configurations from.</em></p>
<p><strong>ConfigStorage</strong> : Filesystem, Windows registry, Environment, networked system etc.
- this provides the (potentially OS-specific) access mechanisms to wherever configurations come from.</p>
<p><em>A ConfigStorage is where configurations are stored.</em></p>
<p><strong>ConfigFormat</strong>  : Java-Properties, JSON, YAML, Windows registry, ...
- this maps general keys to storage-specific addressing, and
- performs format-specific conversions.</p>
<p><em>A ConfigFormat is a format configurations are stored in.</em></p>
<blockquote>
 As of 0.6, there is a confusion between ConfigSource and ConfigStorage;
 also, the layer separation isn't clean yet.

 The ConfigSource would be the instance combination of several tuples;
 for example, using the FileConfigStorage, there would be a number of separate
 ConfigSource entries in the search list, each for a different directory.
 For the WindowsRegistryStorage, there's less of them (HKLM and so on);
 for the EnvironmentVariableStorage, there is probably just one.

 Whether ConfigSource will have different service-type instances is still open;
 the matching of Format and Storage is the tricky bit here.

 (( Should we present the available formats to the storages, ask them for compatibility?
   Should we do it the other way around? The interface between the two may be very
   specific. How to match them, and link them in a general way? ))

Situation as of 0.6

<pre><code class="language-mermaid">flowchart LR
    ConfigSearchList --&gt;|contains several| ConfigLocationImpl
    ConfigLocationImpl --&gt;|adds properties to| ConfigSourceInterface
    ConfigLocationImpl --&gt; location
    ConfigLocationImpl --&gt; flags
    ConfigSourceInterface --&gt; FileConfigSource
    ConfigSourceInterface --&gt; SchemeDefaultConfigSource
</code></pre>

</blockquote>

<p>Planned for 0.7</p>
<pre><code class="language-mermaid">flowchart LR    
    ConfigSearchList --&gt; ConfigSource
    ConfigSource  --&gt; ConfigStorage
    ConfigStorage -..-&gt; ConfigFormat
    ConfigStorage &lt;--&gt; ConfigLocation
    Configuration --&gt; ConfigLocation
</code></pre>
<h4 id="anchor">Anchor<a class="headerlink" href="#anchor" title="Permanent link">&para;</a></h4>
<p>The ConfigFactoryBuilder gathers and combines all the settings.
It creates a <strong>ConfigFactoryInstanceContext</strong> and a ConfigFactory to use it.</p>
<p>The ConfigFactoryInstanceContext is passed to several objects the ConfigFactory
uses, so they can get their respective features, settings, access to a logger,
and so on - it is an internally shared resource.</p>
<h2 id="security-and-secrets">Security and Secrets<a class="headerlink" href="#security-and-secrets" title="Permanent link">&para;</a></h2>
<p>mConfig has built-in support for sensitive data such as passwords, API keys, and private certificates.</p>
<h3 id="secret-redaction">Secret Redaction<a class="headerlink" href="#secret-redaction" title="Permanent link">&para;</a></h3>
<p>Config entries marked as secrets in the <code>ConfigScheme</code> are automatically handled with care:
- Their <code>toString()</code> representation is redacted (<code>[REDACTED]</code>). (using stars could be ambiguous)
- They are stored in specialized <code>SecretConfigEntryLeaf</code> objects.
- In-memory storage uses <code>byte[]</code> or <code>char[]</code> to allow for clearing the data after use.</p>
<h3 id="the-secretvalue-api">The SecretValue API<a class="headerlink" href="#the-secretvalue-api" title="Permanent link">&para;</a></h3>
<p>For programmatically accessing secrets, mConfig provides the <code>SecretValue</code> interface. 
This allows retrieving the sensitive data without it being accidentally converted to a standard <code>String</code> that might linger in the Java String Pool.</p>
<pre><code class="language-java">SecretValue password = config.getSecret(&quot;database/password&quot;);
byte[] rawBytes = password.getValue();
// ... use and then potentially clear the bytes
</code></pre>
<h2 id="binary-data-blobs">Binary Data (BLOBs)<a class="headerlink" href="#binary-data-blobs" title="Permanent link">&para;</a></h2>
<p>Not all configuration is text-based. mConfig supports Binary Large Objects (BLOBs) for things like license files, binary keys, or certificates.</p>
<h3 id="hierarchical-blobs">Hierarchical BLOBs<a class="headerlink" href="#hierarchical-blobs" title="Permanent link">&para;</a></h3>
<p>In modern formats like JSON and YAML, binary data can be embedded directly.
- <strong>YAML</strong> uses the standard <code>!!binary</code> tag.
- <strong>JSON</strong> uses Base64 encoded strings. If a <code>ConfigScheme</code> is provided that marks a key as <code>BYTES</code> type, mConfig will automatically decode the Base64 string into a byte array.</p>
<h3 id="flat-binary-files">Flat Binary Files<a class="headerlink" href="#flat-binary-files" title="Permanent link">&para;</a></h3>
<p>For legacy support or specific use cases, an entire file can be treated as a single binary blob. This uses the <code>binary_file</code> format and is accessed via the empty string key (<code>""</code>).</p>
<pre><code class="language-java">// Retrieving an entire .bin file as a single blob
Configuration licenseCfg = factory.getConfig(&quot;license&quot;);
byte[] licenseData = licenseCfg.getBytes(&quot;&quot;);
</code></pre>
<h3 id="failure-handling">Failure Handling<a class="headerlink" href="#failure-handling" title="Permanent link">&para;</a></h3>
<p>If there is no ConfigEntry found at any layer, and no specific default is found,
the reaction is determined by the ConfigFeature flags set.</p>
<p>(a) return a generic default value depending on the type
(b) throw ConfigException (runtime exception type)
(c) return "null" as ConfigEntry handle, your own code wants to handle the details.
— this will still cause an exception if you are asking for the value only. </p>
<p>It is recommended, though, that you provide for each config entry you are reading
a default value which is sensible and useful in the context of your use case. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="15_test_mode.html" class="btn btn-neutral float-left" title="1.5 Test Mode"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="22_priorities_and_hierarchies.html" class="btn btn-neutral float-right" title="2.2 Priorities and Hierarchies">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="15_test_mode.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="22_priorities_and_hierarchies.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
